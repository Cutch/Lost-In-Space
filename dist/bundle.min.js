function lis(){const _t={"a":"right","b":"24px Arial","c":"#fff","d":"center"};const _s=setTimeout;const _m=Math;const _a=window.addEventListener;let t,e,s={};function i(t,...e){(s[t]||[]).map(t=>t(...e))}function n(){return e}const h=()=>{};class r{constructor(t=0,e=0,s={}){this.x=t,this.y=e}add(t){return new r(this.x+t.x,this.y+t.y,this)}}function o(){return new r(...arguments)}o.prototype=r.prototype,o.t=r;class a extends class{constructor(t){return this.init(t)}init(t={}){this.position=o(),this.s=o(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.s;this.position=this.position.add(e),this.i()}get dx(){return this.s.x}get dy(){return this.s.y}set dx(t){this.s.x=t}set dy(t){this.s.y=t}i(){}}{init({width:t=0,height:e=0,_c:s=n(),h:i=this.o,update:h=this.advance,anchor:r={x:0,y:0},_r:o=0,...a}={}){super.init({width:t,height:e,_c:s,anchor:r,_r:o,...a}),this.l=1,this.u(),this.p=i,this.g=h}h(t){let e=this._c;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this._r&&e.rotate(this._r);let s=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(s||i)&&e.translate(s,i),this.p(),(s||i)&&e.translate(-s,-i),e.restore()}o(){}i(t,e){this.u()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this.i()}set y(t){this.position.y=t,this.i()}get width(){return this.M}set width(t){this.M=t,this.i()}get height(){return this.m}set height(t){this.m=t,this.i()}u(){if(!this.l)return;let{A:t=0,S:e=0,v:s=0}=this.parent||{};this.A=this.x,this.S=this.y,this.k=this.width,this.C=this.height,this.v=s+this._r;let{x:i,y:n}=function(t,e){let s=_m.sin(e),i=_m.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}}({x:this.x,y:this.y},s);this.A=i,this.S=n}get T(){return{x:this.A,y:this.S,width:this.k,height:this.C,_r:this.v}}get _r(){return this._}set _r(t){this._=t,this.i()}}function c(){return new a(...arguments)}c.prototype=a.prototype,c.t=a;class l extends c.t{init({...t}={}){super.init({...t})}o(){this.color&&(this._c.fillStyle=this.color,this._c.fillRect(0,0,this.width,this.height))}}function u(){return new l(...arguments)}u.prototype=l.prototype,u.t=l;let d=/(\d+)(\w+)/;class f extends c.t{init({text:t="",textAlign:e="",lh:s=1,font:i=n().font,...h}={}){super.init({text:t,textAlign:e,lh:s,font:i,...h}),this.H()}get width(){return this.M}set width(t){this.I=1,this.M=t,this.$=t}get text(){return this.F}set text(t){this.I=1,this.F=t}get font(){return this.D}set font(t){this.I=1,this.D=t,this.W=function(t){let e=t.match(d),s=+e[1];return{size:s,U:e[2],L:s}}(t).L}get lh(){return this.q}set lh(t){this.I=1,this.q=t}h(){this.I&&this.H(),super.h()}H(){this.P=[],this.I=0;let t=this._c;t.font=this.font,this.P.length||(this.P.push(this.text),this.M=this.$||t.measureText(this.text).width),this.height=this.W+(this.P.length-1)*this.W*this.lh,this.u()}o(){let t=this.textAlign,e=this._c;this.P.map((s,i)=>{e.textBaseline="top",e.textAlign=t,e.fillStyle=this.color,e.font=this.font,e.fillText(s,0,this.W*this.lh*i)})}}function w(){return new f(...arguments)}function p(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}w.prototype=f.prototype,w.t=f;let x={},g={},M={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:_t.a,ArrowDown:"down"};function m(t){let e=M[t.code];g[e]=1,x[e]&&x[e](t)}function y(t){g[M[t.code]]=0}function A(){g={}}function S(t){return!!g[t]}class v extends c.t{constructor(t){super(t)}o(){const t=this._c;t.fillStyle="#000",t.fillRect(-this.x,-this.y,t.canvas.width,t.canvas.height),t.fillStyle=_t.c;for(let e=0;e<t.canvas.width*t.canvas.height*1e-4;e++)t.fillRect(-this.x+(this.x+(2*_m.pow(e,3)+20*e))%t.canvas.width,-this.y+(this.y+(2*_m.pow(e,3)+20*e))%t.canvas.height,e%3+1,e%3+1)}}const k={font:_t.b,color:_t.c,textAlign:_t.a};class C extends c.t{R=[];N=1;O=0;constructor(t){super(t);this.X=new w(k),this.Y=new w(k),this.j=new w(k),this.B=new w({font:"12px Arial",color:_t.c,text:"Press SPACE to skip"}),this.G=new u({color:"#6009"})}K(t){this.O=t}h(){const t=this;t.X.h(),t.Y.h(),t.j.h(),t.statusText&&(t.G.h(),t.statusText.h(),t.O&&t.B.h())}J(t,e=6e3){this.R.push([t,e]),this.statusText||this.V()}V(){if(clearTimeout(this.Z),this.R.length>0){const[t,e]=this.R.shift();this.statusText=new w({font:_t.b,color:_t.c,text:t,textAlign:_t.d,x:this._c.canvas.width/2,y:20}),this.Z=_s(()=>this.V(),e)}else this.statusText=null}update(t){const e=this,s=e._c.canvas.width,i=e._c.canvas.height;e.X.x=s-20,e.X.y=i-20-24,e.Y.x=s-20,e.Y.y=i-45-20-24,e.j.x=s-20,e.j.y=i-90-20-24,e.Y.text=`Scrap: ${t.tt}t`,e.X.text="Day: "+t.et,e.j.text=`Hull Integrity: ${t.st}%`,e.statusText&&(e.G.width=s,e.G.height=64,e.statusText.x=s/2,e.statusText.y=20,e.O&&(e.B.x=s/2+150,e.B.y=47))}}const T=(t,e)=>_m.sqrt(_m.pow(t.x-e.x,2)+_m.pow(t.y-e.y,2)),E=(t,e)=>_m.sqrt(_m.pow(t,2)+_m.pow(e,2)),_=(t,e)=>_m.atan2(e.y-t.y,e.x-t.x)+_m.PI/2,b="Fire Rate Upgrade",H="Speed Upgrade",I="Warp Drive Fixed, Warping in 3, 2, 1...";class $ extends u.t{constructor(t){super(t={...t,width:2,height:10,color:"#abab46",it:0})}update(t){super.update(),t.filter(t=>(({x:t,y:e},{x:s,y:i,width:n,height:h})=>t>s-n/2&&t<s+n/2&&e>i-h/2&&e<i+h/2)(this,t)).forEach(t=>{this.it=1,t.st--,t.st<=0&&this._c.canvas.dispatchEvent(new CustomEvent("eh",{detail:t}))})}}const F=window.AudioContext||window.webkitAudioContext;let D=()=>{},W=()=>{},L=()=>{};if(F){const t=new F;let e,s,i;D=()=>{const e=t.createOscillator();e.type="square";const s=t.createGain();s.gain.exponentialRampToValueAtTime(1e-4,t.currentTime+.04),e.frequency.value=100,e.connect(s),s.connect(t.destination),e.start(),_s(()=>e.stop(),100)},W=n=>{if(clearTimeout(i),e)s.cancelScheduledValues(t.currentTime),s.setValueAtTime(.05,t.currentTime);else{const i=t.createBiquadFilter();i.type=0,i.Q.value=20,e=[t.createOscillator(),t.createOscillator()];const[h,r]=e;h.frequency.value=10*n,r.frequency.value=25,e.forEach((t,e)=>{t.type="triangle",t.connect(i),t.start(0)});const o=t.createGain();s=o.gain,s.value=.05,i.connect(o),o.connect(t.destination)}},L=()=>{s&&(s.setValueAtTime(s.value,t.currentTime),s.exponentialRampToValueAtTime(1e-5,t.currentTime+.02)),i=_s(()=>{e&&e.forEach(t=>t.stop()),e=null},20)},_a("keydown",()=>{t.resume()})}class U extends c.t{nt=4;ht=0;rt=0;ot=[];at=20;ct=-20;level=1;lt=1;et=0;tt=0;constructor(t){super({width:60,height:60,ut:30,dt:30,ft:0,wt:0,st:100});const e=this,s=e._c;e.pt=t,e.xt=s.createLinearGradient(0,e.dt,0,e.dt+20),e.xt.addColorStop(0,"#f00"),e.xt.addColorStop(.5,"#600"),e.gt=s.createLinearGradient(-40,0,40,0),e.gt.addColorStop(0,"#000"),e.gt.addColorStop(.5,_t.c),e.gt.addColorStop(1,"#000"),e.Mt=[0,-e.dt,-e.ut/4,-e.dt/2,-e.ut/3,0,-e.ut,e.dt/2,-e.ut,.9*e.dt,-e.ut/2,e.dt,e.ut/2,e.dt,e.ut,.9*e.dt,e.ut,e.dt/2,e.ut/3,0,e.ut/4,-e.dt/2],e.yt=[[20,()=>e.at=15,b],[40,()=>(e.nt=5.5,e.lt++),H],[60,()=>e.at=10,b],[80,()=>(e.nt=6.5,e.lt++),H],[100,()=>e.at=5,b],[120,()=>(e.nt=7.5,e.lt++),H],[200,()=>e.ht=1,I]],s.canvas.addEventListener("eh",()=>{e.tt++,e.yt.forEach(([s,i,n])=>{s===e.tt&&(e.level++,i(),t.J(n))})})}o(){const t=this,e=t._c;e.fillStyle=t.gt,e.beginPath();for(let s=0;s<t.Mt.length;s+=2)e.lineTo(t.Mt[s],t.Mt[s+1]);if(e.fill(),t.rt){e.fillStyle=t.xt,e.beginPath();const s=_m.random(),i=_m.floor(2*_m.pow(t.nt/2,2));for(let n=0;n<=12;n++)e.lineTo(-t.ut/2+t.width/2/12*n,t.dt+n%2*(2*i-s*i*_m.sqrt(_m.abs(n/2-3))));e.fill()}}h(){super.h(),this.ot.forEach(t=>t.h())}update(t,e){const s=this;s.ot.forEach((i,n)=>{i.At<e-60||i.it?s.ot.splice(n,1):i.update(t)}),s.et=_m.floor(e/600),t.filter(t=>T({x:s.x,y:s.y},t)<55).forEach(t=>{s.st-=10,s._c.canvas.dispatchEvent(new CustomEvent("eh",{detail:t}))});const i=s.rt;if(s.rt=S("w"),s.rt&&!i?W(s.lt):!s.rt&&i&&L(),S("space")&&e-s.ct>=s.at&&(D(),s.ct=e,s.St(e)),S("w")){s.ft+=.05*-_m.sin(s._r),s.wt+=.05*_m.cos(s._r);const t=E(s.ft,s.wt);t>s.nt&&(s.ft*=s.nt/t,s.wt*=s.nt/t)}S("a")&&(s._r=s._r-.05),S("d")&&(s._r=s._r+.05)}St(t){this.ot.push(new $({dx:10*_m.sin(this._r),dy:10*-_m.cos(this._r),x:this.x+40*_m.sin(this._r),y:this.y-40*_m.cos(this._r),_r:this._r,At:t}))}}const q=["#080","#008","#800"].map(t=>{const e=document.createElement("canvas"),s=e.getContext("2d");e.width=40,e.height=40,s.fillStyle=t,s.fillRect(0,0,40,40);const i=function(t){for(var e=0,s=2166136261;e<t.length;e++)s=_m.imul(s^t.charCodeAt(e),16777619);s+=s<<13,s^=s>>>7,s+=s<<3,s^=s>>>17;let i=(s+=s<<5)>>>0,n=()=>(2**31-1&(i=_m.imul(48271,i)))/2**31;return n(),n}(1);for(let t=0,e=0;t<40||e<40;){const n=_m.floor(7*i()+2);s.fillStyle=i()<.5?"#333":"#222",s.fillRect(t,e,n,_m.floor(7*i()+2)),t+=1+n,t>40&&(e+=5,t=0)}return e});class P extends u.t{constructor(t){super(t={...t,width:40,height:40,ft:0,wt:0,anchor:{x:.5,y:.5}})}update(t){const e=this;this.color=this._c.createPattern(q[this.st-1],null);const s=t.reduce((t,s)=>{if(s!==e){const i=T(e,s);if(i<t.vt){return{angle:_(e,s)+180,vt:i}}}return t},{vt:100,angle:0});let i=_(e,e.kt);100!==s.vt&&(i=s.angle+i/2),e.ft-=.1*_m.sin(i),e.wt+=.1*_m.cos(i);const n=E(e.ft,e.wt),h=e.kt.et,r=_m.min(h/8,5)+5;n>r&&(e.ft*=r/n,e.wt*=r/n),e.dx-=e.ft,e.dy-=e.wt,super.update()}}const R="36px Arial",z=t=>1!==t?"s":"";class N extends c.t{Ct=0;constructor(t,e){super(),L();const s=this;s.background=new u({width:600,height:400,color:"#600A"}),s.Tt=new w({font:_t.b,color:_t.c,text:"Me: These are the coordinates, where's Earth?",textAlign:_t.d}),s.Et=new w({font:_t.b,color:_t.c,text:"Computer: Error: 404. Earth not found.",textAlign:_t.d}),s._t=new w({font:R,color:_t.c,text:"Game Over",textAlign:_t.d}),s.bt=new w({font:R,color:_t.c,text:"Score: "+t.tt,textAlign:_t.d});const i=window.localStorage;if(i){const e=_m.max(i.getItem("lins_score")||0,t.tt),n=i.getItem("lins_day")||0,h=t.tt>=200?_m.min(n,t.et):n;i.setItem("lins_score",e),i.setItem("lins_day",n),s.Ht=new w({font:"18px Arial",color:_t.c,text:`High Score: ${h} day${z(h)}, ${e} scrap`,textAlign:_t.d})}s.X=new w({font:R,color:_t.c,text:`${e?"Completed in":"Lasted"}: ${t.et} day${z(t.et)}`,textAlign:_t.d}),s.It=new w({font:R,color:_t.c,text:"Play Again? Press Enter",textAlign:_t.d}),s.Ct=e}h(){const t=this;t.background.h(),t.Ct?(t.Tt.h(),t.Et.h()):t._t.h(),t.bt.h(),t.X.h(),t.Ht&&t.Ht.h(),t.It.h()}update(){const t=this,e=t._c.canvas.width/2,s=t._c.canvas.height/2;t.background.x=e-t.background.width/2,t.background.y=s-t.background.height/2,t.Tt.x=e,t.Tt.y=s-132,t.Et.x=e,t.Et.y=s-104,t._t.x=e,t._t.y=s-112,t.bt.x=e,t.bt.y=s-56,t.X.x=e,t.X.y=s,t.Ht&&(t.Ht.x=e,t.Ht.y=s+56),t.It.x=e,t.It.y=s+112}}const{canvas:O}=function(s){return t=document.getElementById(s)||s||document.querySelector("canvas"),e=t.getContext("2d"),e.$t=0,i("init"),{canvas:t,_c:e}}();function X(){const t=document.getElementsByTagName("canvas")[0];t.width=window.innerWidth,t.height=window.innerHeight}_a("resize",X,0),X(),function(){let t;for(t=0;t<26;t++)M[t+65]=M["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)M[48+t]=M["Digit"+t]=""+t;_a("keydown",m),_a("keyup",y),_a("blur",A)}();let Y,j,B,G,K,J,Q,V=new w({color:"#600D",font:"70px Arial",textAlign:_t.d,text:"Lost In Space",x:O.width/2,y:O.height/4});const Z=()=>{Y=1,j=null,B=new C,G=new v,K=new U(B),Q=1,J=[],["Me: Where am I?","Computer: Error: 404. Location Not Found.","Me: It looks like I have drifted for 10 warp days. I will have to find my way back.","Me: This may be Corg space, I don't want to get assimil...assinated.","Me: Computer, System Status.","Computer: All critical have been destroyed.","Me: Ugh, now I need some scrap to fix the systems.","Computer: Use my WASD keys to fly and The Bar to shoot."].forEach(t=>B.J(t,_m.max(t.split(" ").length,6)/150*6e4))};Z();let tt=1;const et=function({Ft:t=60,Dt:e=1,update:s=h,h:r,_c:o=n()}={}){let a,c,l,u,d,f=0,w=1e3/t,x=1/t,g=e?p:h;function M(){if(c=requestAnimationFrame(M),l=performance.now(),u=l-a,a=l,!(u>1e3)){for(i("tick"),f+=u;f>=w;)d.update(x),f-=w;g(o),d.h()}}return d={update:s,h:r,Wt:1,start(){a=performance.now(),this.Wt=0,requestAnimationFrame(M)},stop(){this.Wt=1,cancelAnimationFrame(c)}},d}({Dt:0,update:()=>{j?(j.update(),S("enter")&&Z()):Y||(()=>{if(Q%_m.max(3*(30-K.et),30)==0){const t=[1.5*_m.random(),_m.random()-.5];t[1]=_m.sign(t[1])+t[1],_m.random()>.5&&t.reverse();const e=_m.max(2*_m.min((K.et-3)/20,1),0)+1;J.push(new P({x:t[0]*O.width,y:t[1]*O.height,kt:K,st:_m.floor(_m.pow(_m.random(),2)*e+1)}))}Q++,K.update(J,Q),B.update(K),G.dx=K.ft,G.dy=K.wt,G.update(),J.forEach(t=>{t.dx=K.ft,t.dy=K.wt,t.update(J)}),200===K.tt&&_s(()=>{J=[],j=new N(K,1)},3e3)})(),K.x=O.width/2,K.y=O.height/2},h:()=>{G.h(),J.forEach(t=>t.h()),K.h(),B.h(),j?j.h():Y&&(0===B.R.length&&(Y=0),B.K(Y),S("space")?tt&&(tt=0,B.V()):tt=1,B.update(K)),V&&V.h()}});O.addEventListener("eh",({detail:t})=>{J.splice(J.indexOf(t),1),K.st<=0&&(j=new N(K,0))}),et.start(),_s(()=>V=null,6e3);};lis();
